<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.47 in css mode. -->
<html>
  <head>
    <title>Sayid</title>
    <style type="text/css">
    <!--


/* =Reset
-------------------------------------------------------------- */

* {
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
    margin-top: 0;
}

html,
body,
div{
    margin: 0;
    padding: 0;
}

/* =Structures
-------------------------------------------------------------- */

.wrap{
    max-width: 1200px;
    margin: 0 auto;
    padding: 1em 0em;
}

#primary{
    max-width: 900px;
    min-width: 400px;
    margin: 0 auto;
    padding: 0 0.5em;
}

h1 {
  text-align: center;
  font-size: 5em;
  font-family: serif;
  margin: 1em 0 1.4em 0;
}

h2 {
  margin: 1.4em 0 0.7em 0;
  font-size: 2.1em;
}

h3 {
  margin: 1.2em 0 0.7em 0;
  font-size: 1.5em;
}

      body {
        color: #333333;
        background-color: #FFFFFF;
        font-family: sans-serif;
        font-size: 1em;
        line-height: 1.5em;
      }
      pre {
        color: #EDEDED;
        background-color: #222222;
        padding : 0.5em;
        line-height: 1.4em;
        margin: 2em 0;
        font-size: 1.1em;
        white-space: pre-wrap;
      }
      code {
        background-color: #DDDDDD;
        font-size: 1.2em;
        padding: 0.1em 0.2em;
      }
      td {
        padding: 0.5em;
      }
      .ATTRLIST {
        /* (foreground-color . "green3") */
        color: #00cd00;
      }
      .ATTRLIST-1 {
        /* (foreground-color . "yellow3") */
        color: #cdcd00;
      }
      .ATTRLIST-2 {
        /* (background-color . "black") */

      }
      .ATTRLIST-3 {
        /* (foreground-color . "gray90") */
        color: #e5e5e5;
      }
      .ATTRLIST-4 {
        /* (foreground-color . "cyan3") */
        color: #00cdcd;
      }
      .ATTRLIST-5 {
        /* (foreground-color . "red3") */
        color: #cd0000;
      }
      .cider-repl-input {
        /* cider-repl-input-face */
        font-weight: bold;
      }
      .cider-repl-output {
        /* cider-repl-output-face */
        color: #61CE3C;
      }
      .cider-repl-prompt {
        /* cider-repl-prompt-face */
        color: #FBDE2D;
      }
      .cider-repl-result {
      }
      .clojure-keyword {
        /* clojure-keyword-face */
        color: #4c83ff;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #ff1493;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #FBDE2D;
      }
      .type {
        /* font-lock-type-face */
        color: #D8FA3C;
      }

      a {
        color: #0000CC;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>

<body>
    <div id="page">
        <div id="header" class="site-header">
            <div class="wrap">

                <div id="branding" role="banner">

                </div><!--#branding-->

            </div><!--.wrap-->
        </div><!--#header-->

        <div id="main">
            <div class="wrap">

                <div id="primary">
                    <div id="content" role="main">
                      <h1>Sayid</h1>
                      <p>Sayid <i>(siy EED)</i> is a library for debugging and profiling clojure code. It extracts secrets from code at run time.<br><br>
                        Sayid works by intercepting and recording the inputs and outputs of functions. It can even record function calls that occur inside of functions. The user can select which functions to trace. Functions can be selected individually or by namespace. The recorded data can be displayed, queried and profiled.</p>

                      <a href="#contents" style="position:fixed; top:1em; right:1em; font-size:0.9em; padding:0.1em 0.3em; background-color:#CCCCDD">contents</a>
                      <h2 id="contents">Contents</h2>

                      <ul>
                        <li><a href="#quickish-start">Quick<i>ish</i> Start</li>
                        <li><a href="#function-prefixes">Function Prefixes</a></li>
                        <li><a href="#workspaces">Workspaces</a></li>
                        <li><a href="#querying">Querying</a></li>
                        <li><a href="#profiling">Profiling</a></li>
                        <li><a href="#recordings">Recordings</a></li>
                      </ul>


                      <h3>Quick<i>ish</i> Start</h3>
                      <p>
                        Below is a tour of some of what's possible with Sayid in the repl. The following transcript shows how to: <br>
                        <ul>
                          <li>trace functions by namespace</li>
                          <li>trace inside a function</li>
                          <li>print out the results</li>
                          <li>query the results</li>
                        </ul>
                      </p>
                      <p>Require the library and define some dummy example functions. Note the use of the <code>src-in-meta</code> macro. This macro allows Sayid to get at the source code of a function. However, it in not necessary for functions that are defined in a file, which is typically the case.</p>
                          <!-- start repl -->
    <pre>
<span class="cider-repl-prompt">user&gt; </span><span class="cider-repl-input">(require '[</span><span class="type"><span class="cider-repl-input">com.billpiel.sayid.core</span></span><span class="cider-repl-input"> </span><span class="clojure-keyword"><span class="cider-repl-input">:as</span></span><span class="cider-repl-input"> sd])</span>
<span class="cider-repl-result">nil</span>
<span class="cider-repl-prompt">user&gt; </span><span class="cider-repl-input">(sd/src-in-meta
       </span><span class="keyword"><span class="cider-repl-input">defn</span></span><span class="cider-repl-input"> </span><span class="function-name"><span class="cider-repl-input">func-example1</span></span><span class="cider-repl-input"> [a b]
       (* a b))</span>
{<span class="cider-repl-result">:arglists </span>([<span class="cider-repl-result">a b</span>])<span class="cider-repl-result">, :line 1, :column 1, :file "/tmp/form-init146658281467565287.clj", :name func-example1, :ns #object</span>[<span class="cider-repl-result">clojure.lang.Namespace 0x7bad5128 "user"</span>]<span class="cider-repl-result">, :source </span>(<span class="cider-repl-result">defn func-example1 </span>[<span class="cider-repl-result">a b</span>]<span class="cider-repl-result"> </span>(<span class="cider-repl-result">* a b</span>))}
<span class="cider-repl-prompt">user&gt; </span><span class="cider-repl-input">(sd/src-in-meta
       </span><span class="keyword"><span class="cider-repl-input">defn</span></span><span class="cider-repl-input"> </span><span class="function-name"><span class="cider-repl-input">func-example2</span></span><span class="cider-repl-input">
       [a b]
       (</span><span class="keyword"><span class="cider-repl-input">if</span></span><span class="cider-repl-input"> (&lt; a b)
         (</span><span class="keyword"><span class="cider-repl-input">-&gt;</span></span><span class="cider-repl-input"> a
             inc
             (func-example1 b)
             (* 2)
             (vector a b))
         (</span><span class="keyword"><span class="cider-repl-input">recur</span></span><span class="cider-repl-input"> a (inc b))))</span>
{<span class="cider-repl-result">:arglists </span>([<span class="cider-repl-result">a b</span>])<span class="cider-repl-result">, :line 1, :column 1, :file "/tmp/form-init146658281467565287.clj", :name func-example2, :ns #object</span>[<span class="cider-repl-result">clojure.lang.Namespace 0x7bad5128 "user"</span>]<span class="cider-repl-result">, :source </span>(<span class="cider-repl-result">defn func-example2 </span>[<span class="cider-repl-result">a b</span>]<span class="cider-repl-result"> </span>(<span class="cider-repl-result">if </span>(<span class="cider-repl-result">&lt; a b</span>)<span class="cider-repl-result"> </span>(<span class="cider-repl-result">-&gt; a inc </span>(<span class="cider-repl-result">func-example1 b</span>)<span class="cider-repl-result"> </span>(<span class="cider-repl-result">* 2</span>)<span class="cider-repl-result"> </span>(<span class="cider-repl-result">vector a b</span>))<span class="cider-repl-result"> </span>(<span class="cider-repl-result">recur a </span>(<span class="cider-repl-result">inc b</span>))))}
    </pre>
   <p>Now the magic begins. We trace the <code>user</code> namespace. This wraps all functions (ie the two we defined above) in a tracer function that will record the arguments and return value of every call to that function. That trace will be in place until it is <i>untraced</i> or the function is <code>def</code>'d again.</p>
    <pre>
<span class="cider-repl-prompt">user&gt; </span><span class="cider-repl-input">(</span><span class="type"><span class="cider-repl-input">sd</span></span><span class="cider-repl-input">/ws-add-trace-ns! user)</span>
[<span class="cider-repl-result">user</span>]
<span class="cider-repl-prompt">user&gt; </span><span class="cider-repl-input">(func-example2 1 2)</span>
[<span class="cider-repl-result">8 1 2</span>]
    </pre>

    <p>
So, what did we just do? We wrapped every function in the namespace, <code>user</code>, in a tracer function. Then we called a function defined in the namespace. Everything <b>appears</b> to have executed normally -- we got the expected return value. But, behind the scenes, the function call was recorded in what Sayid calls a <b>workspace</b>. More details below on that, but just accept the term, understand that the <code>ws-</code> prefix in the function stands for "workspace" and let's move along.
    </p>
    <p>Now, let's print and see what we've got.</p>

    <pre>
<span class="cider-repl-prompt">user&gt; </span><span class="cider-repl-input">(</span><span class="type"><span class="cider-repl-input">sd</span></span><span class="cider-repl-input">/ws-print)</span>
</span><span class="cider-repl-output"><span class="ATTRLIST-5">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-5"><span class="ATTRLIST-2">user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25398</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">| a =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">1</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">2</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">| returns =&gt; </span></span><span class="ATTRLIST-5">[</span><span class="cider-repl-output"><span class="ATTRLIST-4">8</span></span><span class="cider-repl-output"> </span><span class="cider-repl-output"><span class="ATTRLIST-4">1</span></span><span class="cider-repl-output"> </span><span class="cider-repl-output"><span class="ATTRLIST-4">2</span></span><span class="ATTRLIST-5">]</span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">user/func-example1  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25399</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| a =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">2</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">2</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| returned =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">| </span></span><span class="cider-repl-output"><span class="ATTRLIST-5"><span class="ATTRLIST-2">user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25398</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">| a =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">1</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">2</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">| returned =&gt; </span></span><span class="ATTRLIST-5">[</span><span class="cider-repl-output"><span class="ATTRLIST-4">8</span></span><span class="cider-repl-output"> </span><span class="cider-repl-output"><span class="ATTRLIST-4">1</span></span><span class="cider-repl-output"> </span><span class="cider-repl-output"><span class="ATTRLIST-4">2</span></span><span class="ATTRLIST-5">]</span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-result">nil</span>
</pre>
<p> Well, it's colorful. This output represents the call to the function, <code>func-example2</code>, that we made, and also the call that function made to <code>function-example</code>. By default, the function name, arguments and return value are all conveniently duplicated as execution enters and exits the function. This can be handy if the output is longer than the screen. In addition to those values, there is also a numeric keyword id printed in white next to the function name. That can be useful for certain operations when you want to specify a particular instance of a call to a function.
</p>
<p>Next we'll do a <b>deep</b> trace, which captures function calls made inside the source of a function. After setting the trace, we clear the workspace logs, call the function again, then print what was captured.
</p>
<pre>
<span class="cider-repl-prompt">user&gt; </span><span class="cider-repl-input">(</span><span class="type"><span class="cider-repl-input">sd</span></span><span class="cider-repl-input">/ws-add-deep-trace-fn! func-example2)</span>
<span class="cider-repl-result">user/func-example2</span>
<span class="cider-repl-prompt">user&gt; </span><span class="cider-repl-input">(</span><span class="type"><span class="cider-repl-input">sd</span></span><span class="cider-repl-input">/ws-clear-log!)</span>
[]
<span class="cider-repl-prompt">user&gt; </span><span class="cider-repl-input">(func-example2 3 1)</span>
[<span class="cider-repl-result">32 3 4</span>]
<span class="cider-repl-prompt">user&gt; </span><span class="cider-repl-input">(</span><span class="type"><span class="cider-repl-input">sd</span></span><span class="cider-repl-input">/ws-print)</span>
<span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-5"><span class="ATTRLIST-2">user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25423</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">| a =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">1</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">| returns =&gt; </span></span><span class="ATTRLIST-5">[</span><span class="cider-repl-output"><span class="ATTRLIST-4">32</span></span><span class="cider-repl-output"> </span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output"> </span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="ATTRLIST-5">]</span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">&lt;  user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25424</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| a =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">1</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">inc  user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25425</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">1</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| returned =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">2</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">&lt;  user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25426</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| a =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">2</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">inc  user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25427</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">2</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| returned =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">&lt;  user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25428</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| a =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">inc  user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25429</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| returned =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">&lt;  user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25430</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| a =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| returned =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST">true</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">inc  user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25431</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| a =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| returned =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">func-example1  user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25432</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| </span></span><span class="ATTRLIST-1">(</span><span class="cider-repl-output"><span class="ATTRLIST-1">inc a</span></span><span class="ATTRLIST-1">)</span><span class="cider-repl-output"><span class="ATTRLIST-1"> =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| returns =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">16</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">|</span></span><span class="cider-repl-output"><span class="ATTRLIST">v </span></span><span class="cider-repl-output"><span class="ATTRLIST"><span class="ATTRLIST-2">user/func-example1  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25433</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">|</span></span><span class="cider-repl-output"><span class="ATTRLIST">| a =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">|</span></span><span class="cider-repl-output"><span class="ATTRLIST">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">|</span></span><span class="cider-repl-output"><span class="ATTRLIST">| returned =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">16</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">|</span></span><span class="cider-repl-output"><span class="ATTRLIST">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">func-example1  user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25432</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| </span></span><span class="ATTRLIST-1">(</span><span class="cider-repl-output"><span class="ATTRLIST-1">inc a</span></span><span class="ATTRLIST-1">)</span><span class="cider-repl-output"><span class="ATTRLIST-1"> =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| returned =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">16</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">*  user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25434</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| </span></span><span class="ATTRLIST-1">(</span><span class="cider-repl-output"><span class="ATTRLIST-1">func-example1 </span></span><span class="ATTRLIST-1">(</span><span class="cider-repl-output"><span class="ATTRLIST-1">inc a</span></span><span class="ATTRLIST-1">)</span><span class="cider-repl-output"><span class="ATTRLIST-1"> b</span></span><span class="ATTRLIST-1">)</span><span class="cider-repl-output"><span class="ATTRLIST-1"> =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">16</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| 2 =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">2</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| returned =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">32</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">vector  user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25435</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| </span></span><span class="ATTRLIST-1">(</span><span class="cider-repl-output"><span class="ATTRLIST-1">* </span></span><span class="ATTRLIST-1">(</span><span class="cider-repl-output"><span class="ATTRLIST-1">func-example1 </span></span><span class="ATTRLIST-1">(</span><span class="cider-repl-output"><span class="ATTRLIST-1">inc a</span></span><span class="ATTRLIST-1">)</span><span class="cider-repl-output"><span class="ATTRLIST-1"> b</span></span><span class="ATTRLIST-1">)</span><span class="cider-repl-output"><span class="ATTRLIST-1"> 2</span></span><span class="ATTRLIST-1">)</span><span class="cider-repl-output"><span class="ATTRLIST-1"> =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">32</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| a =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| returned =&gt; </span></span><span class="ATTRLIST-5">[</span><span class="cider-repl-output"><span class="ATTRLIST-4">32</span></span><span class="cider-repl-output"> </span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output"> </span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="ATTRLIST-5">]</span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">| </span></span><span class="cider-repl-output"><span class="ATTRLIST-5"><span class="ATTRLIST-2">user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25423</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">| a =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">1</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">| returned =&gt; </span></span><span class="ATTRLIST-5">[</span><span class="cider-repl-output"><span class="ATTRLIST-4">32</span></span><span class="cider-repl-output"> </span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output"> </span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="ATTRLIST-5">]</span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">^ </span></span><span class="cider-repl-output">


</span><span class="cider-repl-result">nil</span>
</pre>
<p>Whoa. Above we can see each function called within func-example2, the values of the expressions passed to the function and the final return value. This will come in handy while debugging a long threading-macro expression.</p>
<p>At this point, you may be thinking that in a real debugging scenario a LOT of data may be captured -- much more than you'd want to print out and eyeball over. This is why you'd want to use the query functions. Let's search for all the calls to <code>inc</code>.</p>
<pre><span class="cider-repl-prompt">user&gt; </span><span class="cider-repl-input">(</span><span class="type"><span class="cider-repl-input">sd</span></span><span class="cider-repl-input">/p-t (</span><span class="type"><span class="cider-repl-input">sd</span></span><span class="cider-repl-input">/qw [</span><span class="clojure-keyword"><span class="cider-repl-input">:name</span></span><span class="cider-repl-input"> 'inc]))</span>
<span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">inc  user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25425</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">1</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| returned =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">2</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">inc  user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25427</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">2</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| returned =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">inc  user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25429</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| returned =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">inc  user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25431</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| a =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| returned =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-result">nil</span>
</pre>
<p>That worked. But, how did we do it? Let's go piece by piece. <code>p-t</code> stands for "print tree". You can use it to print any captured function call tree. <code>qw</code> stands for "query workspace". These functions have confusing short names because I'm a slow typer. Following <code>qw</code> is the actual query. Queries are represented as vectors where each element is a step in a path (think <code>get-in</code>) and the final element is a predicate. Sayid tries to be very understanding when it comes to these predicates. For example, we navigated to <code>:name</code> (where the function name is kept) and then applied the predicate <code>'inc</code>. Sayid (correctly) assumed that we wanted to do a simple equality check here. Most value types will get this treatment, but others such as regexes and functions will be applied in the ways you'd likely expect.

</p><p> Now let's look for each <code>inc</code> and all of its ancestors. We do this by inserting an <code>:a</code> before the query vector.</p>
<pre>
<span class="cider-repl-prompt">user&gt; </span><span class="cider-repl-input">(</span><span class="type"><span class="cider-repl-input">sd</span></span><span class="cider-repl-input">/p-t (</span><span class="type"><span class="cider-repl-input">sd</span></span><span class="cider-repl-input">/qw </span><span class="clojure-keyword"><span class="cider-repl-input">:a</span></span><span class="cider-repl-input"> [</span><span class="clojure-keyword"><span class="cider-repl-input">:name</span></span><span class="cider-repl-input"> 'inc]))</span>
<span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-5"><span class="ATTRLIST-2">user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25423</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">| a =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">1</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">| returns =&gt; </span></span><span class="ATTRLIST-5">[</span><span class="cider-repl-output"><span class="ATTRLIST-4">32</span></span><span class="cider-repl-output"> </span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output"> </span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="ATTRLIST-5">]</span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">inc  user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25425</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">1</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| returned =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">2</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">inc  user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25427</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">2</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| returned =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">inc  user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25429</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| returned =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">inc  user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25431</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| a =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| returned =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">|</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">| </span></span><span class="cider-repl-output"><span class="ATTRLIST-5"><span class="ATTRLIST-2">user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25423</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">| a =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">1</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">| returned =&gt; </span></span><span class="ATTRLIST-5">[</span><span class="cider-repl-output"><span class="ATTRLIST-4">32</span></span><span class="cider-repl-output"> </span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output"> </span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="ATTRLIST-5">]</span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5">^ </span></span><span class="cider-repl-output">


</span><span class="cider-repl-result"> nil</span>
</pre>
<p>Not surprisingly, the call to <code>func-example2</code> was the only ancestor.</p>
<p>The query functions take a few different modifiers:
  <table>
    <tr><td><code>:a</code></td><td>Returns ancestors of matching nodes.</td></tr>
    <tr><td><code>:d</code></td><td>Returns descendants of matching nodes.</td></tr>
    <tr><td><code>:s</code></td><td>Returns siblings of matching nodes.</td></tr>
    <tr><td><code>:w</code></td><td>Wildcard! Returns ancestors, descendants and siblings of matching nodes.</td></tr>
    <tr><td><code>:r</code></td><td>Range. Takes exactly two query vectors and returns nodes that are both descendants of the first and ancestors of the second.</td></tr>
  </table>

  Additionally, any of <code>:a</code>, <code>:s</code> and <code>:d</code> can be composed into a single keyword, such as <code>:ad</code>.
</p>
<p>Finally, let's find all function calls where the second element of the return value equals 3.</p>

<pre><span class="cider-repl-prompt"> user&gt; </span><span class="cider-repl-input">(</span><span class="type"><span class="cider-repl-input">sd</span></span><span class="cider-repl-input">/p-t (</span><span class="type"><span class="cider-repl-input">sd</span></span><span class="cider-repl-input">/qw [</span><span class="clojure-keyword"><span class="cider-repl-input">:return</span></span><span class="cider-repl-input"> second 3]))</span>
<span class="cider-repl-output"><span class="ATTRLIST-5"> v </span></span><span class="cider-repl-output"><span class="ATTRLIST-5"><span class="ATTRLIST-2">user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25423</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5"> | a =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5"> | b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">1</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5"> | returns =&gt; </span></span><span class="ATTRLIST-5">[</span><span class="cider-repl-output"><span class="ATTRLIST-4">32</span></span><span class="cider-repl-output"> </span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output"> </span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="ATTRLIST-5">]</span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5"> |</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">v </span></span><span class="cider-repl-output"><span class="ATTRLIST-1"><span class="ATTRLIST-2">vector  user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25435</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5"> |</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| </span></span><span class="ATTRLIST-1">(</span><span class="cider-repl-output"><span class="ATTRLIST-1">* </span></span><span class="ATTRLIST-1">(</span><span class="cider-repl-output"><span class="ATTRLIST-1">func-example1 </span></span><span class="ATTRLIST-1">(</span><span class="cider-repl-output"><span class="ATTRLIST-1">inc a</span></span><span class="ATTRLIST-1">)</span><span class="cider-repl-output"><span class="ATTRLIST-1"> b</span></span><span class="ATTRLIST-1">)</span><span class="cider-repl-output"><span class="ATTRLIST-1"> 2</span></span><span class="ATTRLIST-1">)</span><span class="cider-repl-output"><span class="ATTRLIST-1"> =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">32</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5"> |</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| a =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5"> |</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5"> |</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">| returned =&gt; </span></span><span class="ATTRLIST-5">[</span><span class="cider-repl-output"><span class="ATTRLIST-4">32</span></span><span class="cider-repl-output"> </span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output"> </span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="ATTRLIST-5">]</span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5"> |</span></span><span class="cider-repl-output"><span class="ATTRLIST-1">^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5"> | </span></span><span class="cider-repl-output"><span class="ATTRLIST-5"><span class="ATTRLIST-2">user/func-example2  </span></span></span><span class="cider-repl-output"><span class="ATTRLIST-3"><span class="ATTRLIST-2">:25423</span></span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5"> | a =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5"> | b =&gt; </span></span><span class="cider-repl-output"><span class="ATTRLIST-4">1</span></span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5"> | returned =&gt; </span></span><span class="ATTRLIST-5">[</span><span class="cider-repl-output"><span class="ATTRLIST-4">32</span></span><span class="cider-repl-output"> </span><span class="cider-repl-output"><span class="ATTRLIST-4">3</span></span><span class="cider-repl-output"> </span><span class="cider-repl-output"><span class="ATTRLIST-4">4</span></span><span class="ATTRLIST-5">]</span><span class="cider-repl-output">
</span><span class="cider-repl-output"><span class="ATTRLIST-5"> ^ </span></span><span class="cider-repl-output">
</span><span class="cider-repl-result"> nil</span>
<span class="cider-repl-prompt"> user&gt; </span></pre>

<h3 id="function-prefixes">Function Prefixes</h3>
<p>Sayid has multiple namespaces for function implementations, but all
of the functions intended for use are contained in the <code>core</code>
namespace. Because these functions are numerous and cleanly separated by
what values they act on, they can be prefixed for clarity. For example,
workspaces are discussed in the next section. Functions for working with
workspaces are prefixed <code>ws-</code>.</p>

<h3 id="workspaces">Workspaces</h3>
<p>
  When using Sayid, everything stems from workspaces. Here's an example
  of what one looks like:
  <pre>
    {:id :root22440          ;; unique id
     :path [:root22440]      ;; unique path
     :depth 0                ;; depth from root of trace tree
     :children (atom [])     ;; top-level function traces will go here
     :traced {:ns #{com.billpiel.sayid.test.ns1}  ;; this ns is traced
              :fn #{}        ;; no invididually traced functions
              :deep-fn #{}}  ;; no deep traced functions
     :ws-slot nil            ;; workspace has not been saved in the shelf
     :arg-map nil}           ;; not applicable
  </pre>

  This probably raises more questions than it answers, but let's focus
  on <code>:traced</code> and <code>:children</code> for now. Workspaces
  serve two main functions. They keep track of what is traced and they
  serve as the root of a trace tree.</p>

<p>
  Sayid maintains an atom for the <b>active</b> workspace. This is the
  workspace that <code>ws-</code> functions will operate on by
  default. Much of the functionality of this library is available
  through the use of just one workspace. However, it is possible to
  juggle more than one through the use of the <i>shelf.</i> Check these
  out.

  <pre>
<span class="cider-repl-prompt"> user&gt; </span><span class="cider-repl-input">(doc ws-save-as!)</span>
<span class="cider-repl-output"> -------------------------
 com.billpiel.sayid.core/ws-save-as!
 ([slot])
   Saves active workspace to the workspace shelf namespace in the specified `slot`.
</span><span class="cider-repl-result"> nil</span>
<span class="cider-repl-prompt"> user&gt; </span><span class="cider-repl-input">(doc ws-load!)</span>
<span class="cider-repl-output"> -------------------------
 com.billpiel.sayid.core/ws-load!
 ([slot &amp; [force]])
   Loads a workspace from the shelf namespace into the active
   position. Will not overwrite an un-saved active workspace unless
   `force` equals :f
</span><span class="cider-repl-result"> nil</span>
<span class="cider-repl-prompt"> user&gt; </span></pre>

  Cool.
</p>
  <h3 id="querying">Querying</h3>
<p>Once you have some traces captured, you'll want to examine them. You
could just print the whole tree out, but that would be overwhelming for
any non-trivial scenarios. Instead, you can query the tree. To keep
things terse, the querying function you are likely to use most often is
aliased as <code>q</code>. It queries the active workspace and prints
the results. Below is an explanation of querying function arguments
work.
</p>

    <pre>
<span class="cider-repl-prompt"> user&gt; </span><span class="cider-repl-input">(doc query-docs)</span>
<span class="cider-repl-output"> -------------------------
 com.billpiel.sayid.core/query-docs
   There are several querying functions. Many of them take a variadic
   `body` argument. The syntax of the `body` argument is described
   below:

   Body may or may not begin with a keyword modifier, followed by one or
   more vectors or symbols. The keyword modifier expands the query
   results to include nodes that have a specified type of relationship
   with any nodes matching the query. The modifiers are listed here:

   :a -- returns ancestors of matching nodes
   :d -- returns descendants of matching nodes
   :s -- returns siblings of matching nodes
   :w -- wildcard! returns ancestors, descendants and siblings of matching nodes
   :r -- range; takes exactly two query vectors and returns nodes that
         are both descendants of the first and ancestors of the second

   After the optional keyword modifier is one or more vectors or
   symbols. These are the queries themselves. A vector is applied in a
   `get-in` fashion to each trace node, with the final element acting as
   a matching value or predicate function. If the final value is truthy,
   the node is included in the query result set. For example, a `body` of

   :a [:arg-map 'fruit :apple]

   would match any trace node where an argument `fruit` took a
   value :apple, as well as all ancestors of that node.

   If the query is a symbol instead of a vector, the query will match any
   node whose function name matches the symbol. For example, a `body` of

   'somefunc

   is equivalent to: [:name 'somefunc]

</span><span class="cider-repl-result"> nil</span>
<span class="cider-repl-prompt"> user&gt; </span></pre>

    <h3 id="profiling">Profiling</h3>

<p> As a trace occurs, Sayid records the execution start and end
  time. This allows for any number of analyses. Out of the box, Sayid
  provides the two that I find most useful. See docs below:</p>

    <pre>
<span class="cider-repl-prompt"> user&gt; </span><span class="cider-repl-input">(doc sd/pro-net-time)</span>
<span class="cider-repl-output"> -------------------------
 com.billpiel.sayid.core/pro-net-time
 ([tree])
   Takes a tree with profilings data (see `pro-analyze`) and prints a
   table of functions and their profile metrics, sorted by net time
   sum. 'Net time sum' is the amount of time spent in a function minus
   the time spent executing its children. Functions with high net time
   sum may be candidates for optimization.
</span><span class="cider-repl-result"> nil</span>
<span class="cider-repl-prompt"> user&gt; </span><span class="cider-repl-input">(doc sd/pro-gross-repeats)</span>
<span class="cider-repl-output"> -------------------------
 com.billpiel.sayid.core/pro-gross-repeats
 ([tree])
   Takes a tree with profilings data (see `pro-analyze`) and prints a
   table of functions and their profile metrics, sorted by gross time of
   repeated arguments. 'Gross of repeats' is the amount of time spent in
   a function during calls where the args match those of a previous call
   to the function. Functions with high gross of repeats may be
   candidates for memoization.
</span><span class="cider-repl-result"> nil</span>
<span class="cider-repl-prompt"> user&gt; </span></pre>

<p>Not bad, but how do you use the damn thing? Once you have a trace
  tree in your workspace, you can decorate it with profiling data that
  can then be analysed by the functions above. Happy Holidays.</p>

    <pre>
<span class="cider-repl-prompt"> user&gt; </span><span class="cider-repl-input">(def ppp (sd/pro-analyse (sd/ws-deref!)))</span>
<span class="cider-repl-result"> #'user/ppp</span>
<span class="cider-repl-prompt"> user&gt; </span><span class="cider-repl-input">(sd/pro-net-time ppp)</span>
<span class="cider-repl-output" style="font-size: 0.8em">
 |                                :name | :net-time-sum | :net-time-avg | :count | :gross-time-sum | :gross-time-avg |
 |--------------------------------------+---------------+---------------+--------+-----------------+-----------------|
 | :com.billpiel.sayid.test.ns1/func3-1 |             0 |           0.0 |      1 |               0 |             0.0 |
 | :com.billpiel.sayid.test.ns1/func3-2 |             0 |           0.0 |      3 |               0 |             0.0 |
 | :com.billpiel.sayid.test.ns1/func3-3 |             0 |           0.0 |      1 |               0 |             0.0 |
 | :com.billpiel.sayid.test.ns1/func3-4 |             0 |           0.0 |      1 |               0 |             0.0 |
</span><span class="cider-repl-result"> nil</span>
<span class="cider-repl-prompt"> user&gt; </span><span class="cider-repl-input">(sd/pro-gross-repeats ppp)</span>
<span class="cider-repl-output" style="font-size:0.7em">
 |                                :name | :gross-of-repeats | :count | :arg-cardinality | :repeat-arg-pct | :gross-time-sum | :gross-time-avg |
 |--------------------------------------+-------------------+--------+------------------+-----------------+-----------------+-----------------|
 | :com.billpiel.sayid.test.ns1/func3-1 |               0.0 |      1 |                1 |             0.0 |               0 |             0.0 |
 | :com.billpiel.sayid.test.ns1/func3-2 |               0.0 |      3 |                3 |             0.0 |               0 |             0.0 |
 | :com.billpiel.sayid.test.ns1/func3-3 |               0.0 |      1 |                1 |             0.0 |               0 |             0.0 |
 | :com.billpiel.sayid.test.ns1/func3-4 |               0.0 |      1 |                1 |             0.0 |               0 |             0.0 |
</span><span class="cider-repl-result"> nil</span>
<span class="cider-repl-prompt"> user&gt; </span></pre>

<p>Note that I played an HTML trick and shrank the profiling output to
fit the width of the page. Sorry if it still doesn't look right in a
little screen. Also, please ignore all the zeroes. In a better example,
there'd be more rows and more interesting numbers. The key point here is
that the table is sorted by the first column, which allows you two zero
in on the slow guys. Hopefully, you get the idea.</p>




<p>Ok. That's it.</p>

        <!-- end repl -->
                    </div><!-- #content -->
                </div><!-- #primary -->

            </div><!--.wrap-->
        </div><!--#main-->

        <div id="footer" class="site-footer">
            <div class="wrap">

                <p class="site-credits">Copyright (c) Bill Piel, 2016.</p>

            </div><!--.wrap-->
        </div><!--#footer-->

    </div><!--#page-->
</body>


  </body>
</html>
